CREATE TABLE CASA_DISCOGRAFICA(
	nome VARCHAR(30) PRIMARY KEY,
	anno_fondazione INTEGER NOT NULL

);


CREATE TABLE BAND(
	cod_band INTEGER PRIMARY KEY,
	nome VARCHAR(30) NOT NULL,
	data_fondazione date NOT NULL,
	nome_c VARCHAR(30) NOT NULL,
	FOREIGN KEY (nome_c) REFERENCES CASA_DISCOGRAFICA(nome)
	ON DELETE CASCADE ON UPDATE CASCADE

);

CREATE TABLE STUDIO_DI_REGISTRAZIONE(
	nome VARCHAR(30) NOT NULL,
	via VARCHAR(60) NOT NULL,
	cap CHAR(5) NOT NULL,
	citta VARCHAR(60) NOT NULL,
	num_civico INTEGER NOT NULL,
	provincia VARCHAR(60) NOT NULL,
	PRIMARY KEY(nome,citta),

	CHECK(num_civico > 0 )
);

CREATE TABLE CD_MUSICALE(
	nome VARCHAR(60) NOT NULL,
	cod_band INTEGER NOT NULL,
	nome_studio VARCHAR(60) NOT NULL,
	disponibilita INTEGER,
	prezzo_cad INTEGER NOT NULL, 
	durata TIME NOT NULL,
	num_brani INTEGER NOT NULL,
	costo_reg DECIMAL(10,3) NOT NULL,
	citta VARCHAR(60) NOT NULL,
	PRIMARY KEY(nome, cod_band),
	FOREIGN KEY (nome_studio, citta) REFERENCES STUDIO_DI_REGISTRAZIONE(nome, citta)
	ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY (cod_band) REFERENCES BAND(cod_band)
	ON DELETE CASCADE ON UPDATE CASCADE,
	
	CHECK(prezzo_cad > 0),
	CHECK(durata > '00:02:00' ),
	CHECK(num_brani > 0),
	CHECK(disponibilita >= 0)
	

);


CREATE TABLE GENERE_MUSICALE(
	nome VARCHAR(60) PRIMARY KEY,
	popolarita INTEGER NOT NULL,
	CHECK(popolarita > 1500)
	

);

CREATE TABLE ADESIONE(
	nome VARCHAR(60) NOT NULL,
	cod_band INTEGER NOT NULL,
	nome_cd VARCHAR(60) NOT NULL,
	PRIMARY KEY(nome, cod_band, nome_cd),
	
	FOREIGN KEY (nome_cd, cod_band) REFERENCES CD_MUSICALE(nome, cod_band)
	ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY (nome) REFERENCES GENERE_MUSICALE(nome)
	ON DELETE CASCADE ON UPDATE CASCADE
	

);
